<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oti.groupware.approval.dao.ApprovalLineDAO">

	<resultMap id="approvalLineResultMap" type="ApprovalLine">
		<result column="emp_id" property="empId"/>
		<result column="doc_id" property="docId"/>
		<result column="aprv_line_state" property="aprvLineState"/>
		<result column="aprv_line_order" property="aprvLineOrder"/>
		<result column="aprv_line_role" property="aprvLineRole"/>
		<result column="aprv_line_approval_date" property="aprvLineApprovalDate" jdbcType="DATE"/>
		<result column="aprv_line_open_yn" property="aprvLineOpenYn"/>
		<result column="aprv_line_opinion" property="aprvLineOpinion"/>
	</resultMap>
	
	<!-- 임시 -->
	<resultMap type="organization" id="organizationResultMap">
		<result column="emp_id" property="empId"/>
		<result column="pos_id" property="posId"/>
		<result column="dep_id" property="depId"/>
		<result column="emp_mail" property="empMail"/>
		<result column="emp_name" property="empName"/>
        <result column="dep_name" property="depName"/>
        <result column="dep_phone_number" property="depPhoneNumber"/>
		<result column="pos_name" property="posName"/>
	</resultMap>

	<select id="getApprovalLineById" resultMap="approvalLineResultMap">
		SELECT emp_id, doc_id, aprv_line_state, aprv_line_order, aprv_line_role, aprv_line_approval_date, aprv_line_open_yn, aprv_line_opinion
		FROM approval_lines
		WHERE emp_id = #{empId} AND doc_id = #{docId}
	</select>

	<insert id="insertApprovalLine" parameterType="ApprovalLine">
		INSERT INTO approval_lines
		(emp_id, doc_id, aprv_line_state, aprv_line_order, aprv_line_role, aprv_line_approval_date, aprv_line_open_yn, aprv_line_opinion)
		VALUES
		(#{empId}, #{docId}, #{aprvLineState}, #{aprvLineOrder}, #{aprvLineRole}, #{aprvLineApprovalDate,jdbcType=DATE}, #{aprvLineOpenYn}, #{aprvLineOpinion})
	</insert>

	<update id="updateApprovalLine" parameterType="ApprovalLine">
		UPDATE approval_lines SET
		aprv_line_state = #{aprvLineState},
		aprv_line_order = #{aprvLineOrder},
		aprv_line_role = #{aprvLineRole},
		aprv_line_approval_date = #{aprvLineApprovalDate,jdbcType=DATE},
		aprv_line_open_yn = #{aprvLineOpenYn},
		aprv_line_opinion = #{aprvLineOpinion}
		WHERE emp_id = #{empId} AND doc_id = #{docId}
	</update>

	<delete id="deleteApprovalLine">
		DELETE FROM approval_lines WHERE emp_id = #{empId} AND doc_id = #{docId}
	</delete>
	
	<select id="getApprovalLinesBydocId" parameterType="string" resultMap="approvalLineResultMap">
		SELECT emp_id, doc_id, aprv_line_state, aprv_line_order, aprv_line_role, aprv_line_approval_date, aprv_line_open_yn, aprv_line_opinion
		FROM approval_lines
		WHERE doc_id = #{docId}
	</select>
    
    <insert id="insertDraftApprovalLine" parameterType="ApprovalLine">
		INSERT INTO approval_lines
		(emp_id, doc_id, aprv_line_state, aprv_line_order, aprv_line_role)
		VALUES
		(#{empId}, #{docId}, #{aprvLineState}, #{aprvLineOrder}, #{aprvLineRole})
	</insert>
	
	<!-- 임시 -->	
	<select id="getOrganization" resultType="organization">
		SELECT employees.emp_id, employees.pos_id, employees.dep_id, emp_mail, emp_name, dep_name, dep_phone_number, pos_name
		FROM employees, departments, positions
		WHERE emp_name != '장영은' and emp_name != '한송민' and employees.dep_id = departments.dep_id and employees.pos_id = positions.pos_id
		ORDER BY dep_id DESC, pos_id DESC
	</select>
</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oti.groupware.mail.dao.ReceivedMailDAO">

	<resultMap id="receivedMailResultMap" type="receivedMail">
	    <result property="sendMailId" column="send_mail_id"/>
	    <result property="empIdEmployees" column="emp_id_employees"/>
	    <result property="recdMailImportanceYN" column="recd_mail_importance_yn"/>
	    <result property="recdMailDate" column="recd_mail_date"/>
	    <result property="recdMailReadReceiptYN" column="recd_mail_read_receipt_yn"/>
	    <result property="recdMailDelDate" column="recd_mail_del_date"/>
	    <result property="recdMailDelYN" column="recd_mail_del_yn"/>
	    <result property="recdMailDelCompleteYN" column="recd_mail_del_complete_yn"/>
	</resultMap>
	
	<select id="getMailTotalRow" parameterType="string" resultType="int">
		select count(send_mail_id)
		from received_mails
		where emp_id_employees = #{empId} and recd_mail_del_yn = 'N'
	</select>

	<select id="getReceivedMailById" resultMap="receivedMailResultMap">
		SELECT send_mail_id,
		    emp_id_employees,
		    recd_mail_importance_yn,
		    recd_mail_date,
		    recd_mail_read_receipt_yn,
		    recd_mail_del_date,
		    recd_mail_del_yn,
		    recd_mail_del_complete_yn
		FROM received_mails
		WHERE emp_id_employees = #{empId} and recd_mail_del_yn = 'N'
		order by  recd_mail_date desc
		OFFSET (#{pager.pageNo} - 1) * #{pager.rowsPerPage} ROWS
		FETCH NEXT #{pager.rowsPerPage} ROWS ONLY
	</select>
    
    <insert id="insertReceivedMail" parameterType="map">
        INSERT INTO received_mails (
        	send_mail_id, 
        	emp_id_employees, 
        	recd_mail_importance_yn,
            recd_mail_date, 
            recd_mail_read_receipt_yn, 
            recd_mail_del_date, 
            recd_mail_del_yn,
            recd_mail_del_complete_yn)
        VALUES (
        	#{sendMailId}, 
        	#{empId}, 
        	default, 
        	default,
            default, 
            default, 
            default, 
            default)
    </insert>

    <update id="updateReceivedMail" parameterType="receivedMail">
        UPDATE received_mails
        SET recd_mail_importance_yn = #{recdMailImportanceYn}, recd_mail_date = #{recdMailDate},
            recd_mail_read_receipt_yn = #{recdMailReadReceiptYn}, recd_mail_del_date = #{recdMailDelDate},
            recd_mail_del_yn = #{recdMailDelYn}, recd_mail_del_complete_yn = #{recdMailDelCompleteYn},
            recd_sr = #{recdSr}
        WHERE send_mail_id = #{sendMailId} AND emp_id_employees = #{empIdEmployees}
    </update>

    <delete id="deleteReceivedMail">
        DELETE FROM received_mails WHERE send_mail_id = #{sendMailId} AND emp_id_employees = #{empIdEmployees}
    </delete>
    
</mapper>